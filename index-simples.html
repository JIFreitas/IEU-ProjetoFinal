<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Escape Room - Casa Assombrada</title>

    <!-- CSS do index -->
    <link rel="stylesheet" href="assets/styles/index.css" />

    <!-- Common JS (settings em localStorage) -->
    <script src="assets/scripts/common.js"></script>
    <script src="assets/scripts/game.js"></script>
  </head>

  <body>
    <div class="settings-icon" onclick="toggleSettings()">
      <span class="icon">‚öôÔ∏è</span>
      <span>CONFIGURA√á√ïES</span>
    </div>

    <div
      class="settings-overlay"
      id="settings-overlay"
      onclick="closeSettingsIfOverlay(event)"
    >
      <div class="settings-modal">
        <span class="close-settings" onclick="toggleSettings()">√ó</span>
        <h3 class="settings-title">CONFIGURA√á√ïES</h3>

        <div class="setting-item">
          <span>M√∫sica Ambiente:</span>
          <div
            class="toggle active"
            id="music-toggle"
            onclick="toggleMusicSetting()"
          >
            <div class="toggle-slider"></div>
          </div>
        </div>

        <div class="setting-item">
          <span>Volume:</span>
          <input
            type="range"
            id="volume-slider"
            min="0"
            max="100"
            value="40"
            oninput="updateVolume(this.value)"
          />
          <span id="volume-value">40%</span>
        </div>
      </div>
    </div>

    <div class="container">
      <h1>ESCAPE ROOM</h1>
      <p>Bem-vindo √† Casa Assombrada. Conclui os 3 n√≠veis para escapar!</p>

      <div class="info">
        <h3>COMO JOGAR</h3>
        <ul>
          <li><strong>WASD</strong> - Mover</li>
          <li><strong>Mouse</strong> - Olhar em redor</li>
          <li>
            <strong>Cursor vermelho</strong> - Olha para objetos brilhantes
          </li>
          <li>
            <strong>Clique autom√°tico</strong> - Mant√©m o cursor sobre o objeto
          </li>
          <li><strong>ESC</strong> - Menu de pausa (durante o jogo)</li>
        </ul>
      </div>

      <div class="levels">
        <a
          id="btn-level-1"
          href="pages/nivel1-simples.html"
          class="level-btn"
          data-level="1"
        >
          <span class="level-title">N√çVEL 1 - Entrada</span><br />
          <small class="level-sub">Encontra 3 chaves</small>
        </a>

        <a
          id="btn-level-2"
          href="pages/nivel2-simples.html"
          class="level-btn"
          data-level="2"
        >
          <span class="lock-badge" aria-hidden="true">üîí</span>
          <span class="level-title">N√çVEL 2 - Corredor</span><br />
          <small class="level-sub">Acende 4 velas pela ordem</small>
        </a>

        <a
          id="btn-level-3"
          href="pages/nivel3-simples.html"
          class="level-btn"
          data-level="3"
        >
          <span class="lock-badge" aria-hidden="true">üîí</span>
          <span class="level-title">N√çVEL 3 - Sala Final</span><br />
          <small class="level-sub">Descobre o c√≥digo secreto</small>
        </a>

        <a
          id="btn-level-4"
          href="pages/nivel4-simples.html"
          class="level-btn"
          data-level="4"
        >
          <span class="lock-badge" aria-hidden="true">üîí</span>
          <span class="level-title">N√çVEL 4 - Final (UV)</span><br />
          <small class="level-sub">UV + Terminal</small>
        </a>
      </div>

      <!-- Aviso (toast) quando se clica em n√≠vel bloqueado -->
      <div id="toast" class="toast" role="status" aria-live="polite"></div>
    </div>

    <script>
      // ===== Aplicar settings guardadas (via common.js) =====
      function syncIndexSettingsUI() {
        const enabled = getMusicEnabled();
        const vol = getMusicVolume();

        const musicToggle = document.getElementById("music-toggle");
        const volumeSlider = document.getElementById("volume-slider");
        const volumeValue = document.getElementById("volume-value");

        musicToggle?.classList.toggle("active", enabled);
        if (volumeSlider) volumeSlider.value = String(vol);
        if (volumeValue) volumeValue.textContent = `${vol}%`;
      }

      // ===== Fun√ß√µes do overlay (UI) =====
      function toggleSettings() {
        document.getElementById("settings-overlay").classList.toggle("active");
      }

      function closeSettingsIfOverlay(evt) {
        if (evt.target.id === "settings-overlay") toggleSettings();
      }

      // ===== Fun√ß√µes do index que gravam settings (via common.js) =====
      function toggleMusicSetting() {
        setMusicEnabled(!getMusicEnabled());
        syncIndexSettingsUI();
      }

      function updateVolume(value) {
        const vol = parseInt(value, 10);
        if (Number.isNaN(vol)) return;

        setMusicVolume(vol);

        const volumeValue = document.getElementById("volume-value");
        if (volumeValue) volumeValue.textContent = `${vol}%`;
      }

      // ===== Toast =====
      let toastTimeoutId = null;

      function showToast(message) {
        const toast = document.getElementById("toast");
        if (!toast) return;

        toast.textContent = message;
        toast.classList.add("show");

        clearTimeout(toastTimeoutId);
        toastTimeoutId = setTimeout(() => {
          toast.classList.remove("show");
        }, 2200);
      }

      function preventLockedClick(evt) {
        evt.preventDefault();

        const a = evt.currentTarget;
        const level = a?.getAttribute("data-level") || "?";
        showToast(
          `üîí O N√≠vel ${level} ainda est√° bloqueado. Conclui o n√≠vel anterior para o desbloqueares.`
        );
      }

      function setButtonLocked(a, locked) {
        if (!a) return;

        a.classList.toggle("locked", locked);
        a.setAttribute("aria-disabled", locked ? "true" : "false");

        if (locked) {
          a.addEventListener("click", preventLockedClick);
        } else {
          a.removeEventListener("click", preventLockedClick);
        }
      }

      function syncLevelButtons() {
        const btn2 = document.getElementById("btn-level-2");
        const btn3 = document.getElementById("btn-level-3");
        const btn4 = document.getElementById("btn-level-4");

        const unlocked2 =
          typeof isUnlockedLevel === "function" ? isUnlockedLevel(2) : false;
        const unlocked3 =
          typeof isUnlockedLevel === "function" ? isUnlockedLevel(3) : false;
        const unlocked4 =
          typeof isUnlockedLevel === "function" ? isUnlockedLevel(4) : false;

        setButtonLocked(btn2, !unlocked2);
        setButtonLocked(btn3, !unlocked3);
        setButtonLocked(btn4, !unlocked4);
      }

      window.addEventListener("DOMContentLoaded", () => {
        syncIndexSettingsUI();
        syncLevelButtons();
      });
    </script>
  </body>
</html>
