<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Nível 3 - Terminal das Cores</title>

    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.6.1/dist/aframe-extras.min.js"></script>

    <link rel="stylesheet" href="../assets/styles/common.css" />

    <!-- Core -->
    <script defer src="../assets/scripts/common.js"></script>
    <script defer src="../assets/scripts/game.js"></script>

    <!-- UI do terminal -->
    <style>
      #terminal-overlay {
        position: fixed;
        inset: 0;
        display: none;
        z-index: 2500;
        background: rgba(0, 0, 0, 0.6);
        align-items: center;
        justify-content: center;
      }

      #terminal-overlay .panel {
        width: min(520px, calc(100vw - 36px));
        background: rgba(0, 0, 0, 0.95);
        border: 2px solid rgba(0, 255, 0, 0.35);
        border-radius: 14px;
        padding: 18px 18px 16px;
        color: #e8e8e8;
      }

      #terminal-overlay .row {
        display: grid;
        grid-template-columns: 26px 1fr;
        gap: 12px;
        align-items: center;
        margin: 10px 0;
      }

      #terminal-overlay .swatch {
        width: 20px;
        height: 20px;
        border-radius: 4px;
        border: 1px solid rgba(255, 255, 255, 0.22);
      }

      #terminal-overlay input {
        font-size: 22px;
        width: 100%;
        padding: 10px 12px;
        border: 2px solid rgba(0, 255, 0, 0.35);
        background: #080808;
        color: #d6ffd6;
        outline: none;
        border-radius: 10px;
      }

      #terminal-overlay .actions {
        display: flex;
        gap: 10px;
        margin-top: 14px;
      }

      #terminal-overlay button {
        font-size: 16px;
        padding: 10px 14px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
      }

      #terminal-confirm {
        background: #00ff00;
      }

      #terminal-close {
        background: #333;
        color: #fff;
      }
    </style>
  </head>

  <body>
    <div id="hud">
      <div>Terminal: <span id="terminal-state">TRANCADO</span></div>
      <div id="msg">Conta os objetos por cor e insere no terminal (esq → dir).</div>
      <div class="hud-hint">Pressione ESC para pausar</div>
    </div>

    <div id="timer-top" class="timer-top" aria-label="Tempo restante">
      <span id="timer-text">00:00</span>
    </div>

    <div id="pause-menu" class="theme-green">
      <h2>JOGO PAUSADO</h2>

      <div class="setting-row">
        <span>Música:</span>
        <div
          class="toggle active"
          id="music-toggle"
          onclick="togglePauseMusic()"
        >
          <div class="toggle-slider"></div>
        </div>
      </div>

      <div class="setting-row">
        <span>Volume:</span>
        <input
          type="range"
          min="0"
          max="100"
          value="40"
          id="volume-control"
          oninput="updatePauseVolume(this.value)"
        />
        <span id="vol-display">40%</span>
      </div>

      <button class="menu-btn btn-green" onclick="resumeGame()">
        Continuar
      </button>
      <button
        class="menu-btn btn-green"
        onclick="window.location.href='../index-simples.html'"
      >
        Menu Principal
      </button>
    </div>

    <!-- Overlay do terminal (inserir contagens) -->
    <div id="terminal-overlay" aria-hidden="true">
      <div class="panel">
        <h2 style="color: #00ff00; margin: 0 0 6px 0">Terminal das Cores</h2>
        <div style="opacity: 0.9; margin-bottom: 12px">
          Insere a contagem seguindo a ordem das cores no terminal (<b>esq → dir</b>).
          <div id="terminal-order-text" style="margin-top: 6px; color: #c8ffc8; font-size: 14px"></div>
        </div>

        <div class="row">
          <div class="swatch" data-slot="0" style="background: #c0392b"></div>
          <input id="term-slot-0" inputmode="numeric" maxlength="2" placeholder="1ª cor" />
        </div>
        <div class="row">
          <div class="swatch" data-slot="1" style="background: #2980b9"></div>
          <input id="term-slot-1" inputmode="numeric" maxlength="2" placeholder="2ª cor" />
        </div>
        <div class="row">
          <div class="swatch" data-slot="2" style="background: #27ae60"></div>
          <input id="term-slot-2" inputmode="numeric" maxlength="2" placeholder="3ª cor" />
        </div>
        <div class="row">
          <div class="swatch" data-slot="3" style="background: #f1c40f"></div>
          <input id="term-slot-3" inputmode="numeric" maxlength="2" placeholder="4ª cor" />
        </div>

        <div id="terminal-msg" style="margin-top: 10px; min-height: 22px"></div>

        <div class="actions">
          <button id="terminal-confirm" type="button">Confirmar</button>
          <button id="terminal-close" type="button">Fechar</button>
        </div>
      </div>
    </div>

    <a-scene fog="type: exponential; color: #050505; density: 0.035">
      <a-assets>
        <canvas id="tex-floor" width="512" height="512"></canvas>
        <canvas id="tex-wall" width="512" height="512"></canvas>
        <canvas id="tex-wood" width="512" height="512"></canvas>
        <canvas id="tex-ceiling" width="512" height="512"></canvas>
      </a-assets>

      <a-sky color="#030303"></a-sky>

      <!-- Chão -->
      <a-plane
        id="floor"
        position="0 0 0"
        rotation="-90 0 0"
        width="11"
        height="11"
        material="shader: standard; color: #2a2520; roughness: 1; metalness: 0"
        nav-mesh
      ></a-plane>

      <!-- Paredes -->
      <a-box
        position="0 2 -6"
        width="12"
        height="4"
        depth="0.2"
        class="wall"
        material="shader: standard; color: #6b5e52; roughness: 1; metalness: 0"
      ></a-box>
      <a-box
        position="-6 2 0"
        width="0.2"
        height="4"
        depth="12"
        class="wall"
        material="shader: standard; color: #6b5e52; roughness: 1; metalness: 0"
      ></a-box>
      <a-box
        position="6 2 0"
        width="0.2"
        height="4"
        depth="12"
        class="wall"
        material="shader: standard; color: #6b5e52; roughness: 1; metalness: 0"
      ></a-box>
      <a-box
        position="0 2 6"
        width="12"
        height="4"
        depth="0.2"
        class="wall"
        material="shader: standard; color: #6b5e52; roughness: 1; metalness: 0"
      ></a-box>

      <!-- Teto -->
      <a-plane
        id="ceiling"
        position="0 4 0"
        rotation="90 0 0"
        width="12"
        height="12"
        material="shader: standard; color: #1a1a1a; roughness: 1; metalness: 0"
      ></a-plane>

      <!-- Objetos coloridos espalhados (para contar) -->
      <!-- Vermelho (3) -->
      <a-box class="countable" data-color="red" position="-4.2 0.3 -1.6" width="0.55" height="0.6" depth="0.55" material="shader: standard; color: #c0392b; roughness: 0.85"></a-box>
      <a-sphere class="countable" data-color="red" position="3.8 0.28 2.1" radius="0.28" material="shader: standard; color: #c0392b; roughness: 0.6"></a-sphere>
      <a-cylinder class="countable" data-color="red" position="-0.6 0.35 4.2" radius="0.22" height="0.7" material="shader: standard; color: #c0392b; roughness: 0.85"></a-cylinder>

      <!-- Azul (5) -->
      <a-sphere class="countable" data-color="blue" position="-3.8 0.25 3.6" radius="0.24" material="shader: standard; color: #2980b9; roughness: 0.6"></a-sphere>
      <a-box class="countable" data-color="blue" position="4.1 0.26 -3.1" width="0.5" height="0.5" depth="0.5" material="shader: standard; color: #2980b9; roughness: 0.8"></a-box>
      <a-cylinder class="countable" data-color="blue" position="1.2 0.28 -4.0" radius="0.2" height="0.55" material="shader: standard; color: #2980b9; roughness: 0.85"></a-cylinder>
      <a-sphere class="countable" data-color="blue" position="-1.8 0.25 -4.4" radius="0.23" material="shader: standard; color: #2980b9; roughness: 0.6"></a-sphere>
      <a-box class="countable" data-color="blue" position="2.4 0.25 4.4" width="0.45" height="0.45" depth="0.45" material="shader: standard; color: #2980b9; roughness: 0.8"></a-box>

      <!-- Verde (4) -->
      <a-sphere class="countable" data-color="green" position="-4.4 0.26 1.2" radius="0.25" material="shader: standard; color: #27ae60; roughness: 0.7"></a-sphere>
      <a-box class="countable" data-color="green" position="0.9 0.25 3.5" width="0.48" height="0.48" depth="0.48" material="shader: standard; color: #27ae60; roughness: 0.85"></a-box>
      <a-cylinder class="countable" data-color="green" position="3.7 0.28 0.5" radius="0.2" height="0.6" material="shader: standard; color: #27ae60; roughness: 0.9"></a-cylinder>
      <a-sphere class="countable" data-color="green" position="-1.2 0.25 -2.8" radius="0.22" material="shader: standard; color: #27ae60; roughness: 0.7"></a-sphere>

      <!-- Amarelo (2) -->
      <a-box class="countable" data-color="yellow" position="-3.2 0.25 -4.2" width="0.46" height="0.46" depth="0.46" material="shader: standard; color: #f1c40f; roughness: 0.8"></a-box>
      <a-sphere class="countable" data-color="yellow" position="4.1 0.25 3.2" radius="0.24" material="shader: standard; color: #f1c40f; roughness: 0.65"></a-sphere>

      <!-- Decoração (só para preencher) -->
      <a-plane position="0 0.01 0" rotation="-90 0 0" width="4.6" height="4.6" material="shader: standard; color: #151212; opacity: 0.55; transparent: true; roughness: 1"></a-plane>
      <a-entity position="-5.25 0 -3.6" rotation="0 90 0">
        <a-box position="0 0.5 0" width="1.8" height="1" depth="0.5" material="shader: standard; src: #tex-wood; roughness: 0.9; color: #4b2b15"></a-box>
        <a-box position="0 1.05 0" width="1.85" height="0.15" depth="0.55" material="shader: standard; src: #tex-wood; roughness: 0.92; color: #3b2212"></a-box>
      </a-entity>

      <!-- Terminal (4 cores na frente: ordem esq->dir) -->
      <a-box
        id="terminal"
        class="interactable"
        data-order="red,blue,green,yellow"
        position="3.2 1.4 -5.15"
        rotation="0 0 0"
        width="1.2"
        height="1.6"
        depth="0.35"
        material="shader: standard; color: #1f1f1f; roughness: 0.95; metalness: 0.1"
      >
        <a-text
          id="terminal-status-text"
          value="TERMINAL\n[CLIQUE]"
          position="0 0.35 0.19"
          align="center"
          color="#00ff00"
          width="2.2"
        ></a-text>

        <a-entity position="0 -0.25 0.19">
          <a-box class="terminal-swatch" data-slot="0" position="-0.38 0 0" width="0.18" height="0.18" depth="0.02" material="color: #c0392b"></a-box>
          <a-box class="terminal-swatch" data-slot="1" position="-0.13 0 0" width="0.18" height="0.18" depth="0.02" material="color: #2980b9"></a-box>
          <a-box class="terminal-swatch" data-slot="2" position="0.12 0 0" width="0.18" height="0.18" depth="0.02" material="color: #27ae60"></a-box>
          <a-box class="terminal-swatch" data-slot="3" position="0.37 0 0" width="0.18" height="0.18" depth="0.02" material="color: #f1c40f"></a-box>
        </a-entity>
      </a-box>

      <!-- Porta (moldura + folha com dobradiça) -->
      <a-entity id="doorframe" position="0 1.59 -5.9">
        <a-box position="0 0 0.06" width="2.18" height="3.18" depth="0.08" material="shader: standard; src: #tex-wood; repeat: 1 1; roughness: 0.8; metalness: 0.02; color: #5b331a"></a-box>
      </a-entity>
      <a-entity id="doorPivot" position="-1 1.59 -5.9">
        <a-box id="door" class="interactable" position="1 0 0" width="2" height="3" depth="0.22" material="opacity: 0; transparent: true"></a-box>
        <a-box position="1 0 0.1" width="1.92" height="2.92" depth="0.1" material="shader: standard; src: #tex-wood; repeat: 1 1; roughness: 0.85; metalness: 0.02; color: #6a3a1d"></a-box>
        <a-sphere position="1.78 0.05 0.18" radius="0.09" material="shader: standard; color: #b9b9b9; metalness: 0.9; roughness: 0.3"></a-sphere>
      </a-entity>
      <a-plane id="door-text-bg" visible="false" position="0 3.14 -5.7" width="2.2" height="0.38" material="color: #000; opacity: 0.55; transparent: true"></a-plane>
      <a-text id="door-text" visible="false" value="PORTA TRANCADA" position="0 3.14 -5.69" align="center" color="#ffdddd" width="4.5"></a-text>

      <!-- Luz -->
      <a-light type="ambient" intensity="0.18"></a-light>
      <a-light type="point" position="0 3.3 1.2" intensity="0.75" color="#d9ffd9" distance="18"></a-light>

      <!-- Rig -->
      <a-entity
        id="rig"
        position="0 0 5"
        clamp-bounds="minX: -5.8; maxX: 5.8; minZ: -5.8; maxZ: 5.8; margin: 0.05"
        movement-controls="speed: 0.3; fly: false; constrainToNavMesh: true"
      >
        <a-camera
          position="0 1.6 0"
          wasd-controls="enabled: false"
          look-controls="pointerLockEnabled: false"
        >
          <a-cursor
            color="#00ff00"
            fuse="true"
            fuse-timeout="800"
            raycaster="objects: .interactable"
          ></a-cursor>
        </a-camera>
      </a-entity>
    </a-scene>

    <audio id="bg-music" loop preload="auto">
      <source src="../assets/sounds/musica-ambiente.mp3" type="audio/mpeg" />
    </audio>

    <audio id="sfx-door-open" preload="auto">
      <source src="../assets/sounds/door-opening.mp3" type="audio/mpeg" />
    </audio>
    <audio id="sfx-door-locked" preload="auto">
      <source src="../assets/sounds/door-locked.mp3" type="audio/mpeg" />
    </audio>
    <audio id="sfx-hmm-reflexion" preload="auto">
      <source src="../assets/sounds/hmm-reflexion.mp3" type="audio/mpeg" />
    </audio>

    <!-- Script do nível -->
    <script src="../assets/scripts/levels/level3.js?v=3"></script>
  </body>
</html>
